<div class="chat-container">
  <div class="chat-header">
    <h2>Чат с DeepSeek</h2>
    <div>
      <label>
        <input
          type="radio"
          name="mode"
          [checked]="mode() === 'book'"
          (change)="mode.set('book'); sendBookFirstMessage()"
        />
        Рекомендуй книги
      </label>

      <label>
        <input
          type="radio"
          name="mode"
          [checked]="mode() === 'json'"
          (change)="mode.set('json'); clearChat()"
        />
        Ответы в формате JSON
      </label>

      <label>
        <input
          type="radio"
          name="mode"
          [checked]="mode() === null"
          (change)="mode.set(null); clearChat()"
        />
        Обычный режим
      </label>

      <button (click)="clearChat()">Очистить</button>
    </div>
  </div>

  <div class="chat-messages">
    @for (msg of messages(); track msg;) {
      @if (msg.role === 'user' || msg.role === 'assistant') {
        <div class="message" [class.user]="msg.role === 'user'">
          <strong>{{ msg.role === 'user' ? 'Вы' : 'DeepSeek' }}:</strong>
          @if (formatJson(msg.content); as json) {
            <pre class="json-response">{{ json }}</pre>
          } @else {
            <p class="formatted-text">{{ msg.content }}</p>
          }
        </div>
      }
    }

    @if (isLoading()) {
      <div class="message assistant">
        <strong>DeepSeek:</strong>
        <p>Печатает...</p>
      </div>
    }
  </div>

  <div class="chat-input">
        <textarea
          [(ngModel)]="userInput"
          placeholder="Введите сообщение..."
          (keydown.enter)="sendMessage(); $event.preventDefault()"
          [disabled]="isLoading()"
        ></textarea>
    <button
      (click)="sendMessage()"
      [disabled]="!userInput.trim() || isLoading()"
    >
      Отправить
    </button>
  </div>
</div>

@if (error()) {
  <div class="error">{{ error() }}</div>
}
